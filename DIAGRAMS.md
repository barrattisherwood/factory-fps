# ğŸ—ï¸ Architecture Diagram

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           GAME.JS                               â”‚
â”‚                      (Main Game Loop)                           â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚   EventBus    â”‚  â”‚DebugRenderer â”‚  â”‚ResourceManagerâ”‚       â”‚
â”‚  â”‚  (Central)    â”‚  â”‚  (Press `)   â”‚  â”‚ (Metal/Energy)â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚          â”‚                                                      â”‚
â”‚          â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ AmmoManager  â”‚                           â”‚
â”‚                     â”‚(Kinetic/Flux) â”‚                           â”‚
â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚              â”‚              â”‚
                â–¼              â–¼              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Player   â”‚   â”‚  Enemy   â”‚   â”‚    UI    â”‚
        â”‚          â”‚   â”‚          â”‚   â”‚          â”‚
        â”‚ â€¢ Shoot  â”‚   â”‚ â€¢ Config â”‚   â”‚ â€¢ Listen â”‚
        â”‚ â€¢ Pool   â”‚   â”‚ â€¢ Drops  â”‚   â”‚ â€¢ Update â”‚
        â”‚ â€¢ Events â”‚   â”‚ â€¢ Damage â”‚   â”‚ â€¢ Events â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚ Resource Orbs    â”‚
                     â”‚ â€¢ Typed (3 types)â”‚
                     â”‚ â€¢ Auto-collect   â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Event Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Player  â”‚
â”‚  Shoots  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AmmoManager     â”‚
â”‚  .consume()      â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ emits: ammo:changed
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    EventBus      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚    UI    â”‚
â”‚   (Central Hub)  â”‚         â”‚ Updates  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ emits: weapon:fired
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Sound System    â”‚
â”‚  (Future)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Enemy Damage Flow

```
Player Shoots
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Raycast Hit    â”‚
â”‚   detection      â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Enemy.takeDamage(amount, type)  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Apply Weakness from Config       â”‚
â”‚ damage * config.weaknesses[type] â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼ HP <= 0?
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Enemy.die()                      â”‚
â”‚ â€¢ Create explosion particles     â”‚
â”‚ â€¢ Spawn resource orbs (config)   â”‚
â”‚ â€¢ Emit enemy:killed event        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Object Pool Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Bullet Pool    â”‚
â”‚  (50 pre-made)  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ .get()
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Use Bullet     â”‚
â”‚  â€¢ Set position â”‚
â”‚  â€¢ Set color    â”‚
â”‚  â€¢ Add to scene â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ After 100ms
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  .release()     â”‚
â”‚  â€¢ Reset state  â”‚
â”‚  â€¢ Return pool  â”‚
â”‚  â€¢ No GC! âœ…    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data-Driven Config Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ config/          â”‚
â”‚ enemies.js       â”‚
â”‚                  â”‚
â”‚ standard: {      â”‚
â”‚   hp: 100,       â”‚
â”‚   weaknesses: {} â”‚
â”‚   drops: []      â”‚
â”‚ }                â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ import
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ new Enemy(       â”‚
â”‚   x, y, z,       â”‚
â”‚   'standard'     â”‚
â”‚ )                â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ loads config
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Enemy instance   â”‚
â”‚ â€¢ config.hp      â”‚
â”‚ â€¢ config.color   â”‚
â”‚ â€¢ config.drops   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Manager Communication

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AmmoManager     â”‚
â”‚                  â”‚
â”‚ â€¢ Owns ammo data â”‚
â”‚ â€¢ NO direct refs â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ EventBus
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ResourceManager â”‚
â”‚                  â”‚
â”‚ â€¢ Owns resources â”‚
â”‚ â€¢ NO direct refs â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ EventBus
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  QuestManager    â”‚
â”‚  (Future)        â”‚
â”‚                  â”‚
â”‚ â€¢ Tracks quests  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

All communication via EventBus!
No manager stores reference to another manager.
```

## Debug Rendering

```
Press ` key
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚DebugRenderer     â”‚
â”‚ .enabled = true  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â–º drawRay() â”€â”€â”€â”€â”€â”€â–º See shooting direction
     â”‚
     â”œâ”€â–º drawSphere() â”€â”€â”€â–º See collection radius
     â”‚
     â”œâ”€â–º drawPoint() â”€â”€â”€â”€â–º See hit locations
     â”‚
     â””â”€â–º drawBox() â”€â”€â”€â”€â”€â”€â–º See collision boxes
```

## Phase 6 Preparation (Dual Ammo)

```
Current State: âœ… Ready!

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AmmoManager     â”‚
â”‚                  â”‚
â”‚ kinetic: 50      â”‚
â”‚ flux: 0          â”‚
â”‚ caustic: 0       â”‚
â”‚                  â”‚
â”‚ currentType: 'k' â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

To Complete:
1. Add key bindings (1/2/3)
2. Multi-ammo UI
3. Varied enemy spawns

Already Works:
âœ… Switch types
âœ… Different colors
âœ… Damage types
âœ… Weakness system
```

## Class Relationships

```
Game
 â”œâ”€â”€ events: EventBus
 â”œâ”€â”€ resourceManager: ResourceManager(events)
 â”œâ”€â”€ ammoManager: AmmoManager(events)
 â”œâ”€â”€ debug: DebugRenderer(scene)
 â”œâ”€â”€ player: Player(camera, game)
 â”œâ”€â”€ enemies: Enemy[]
 â”œâ”€â”€ orbs: ResourceOrb[]
 â””â”€â”€ ui: UI(events)

Player
 â”œâ”€â”€ bulletPool: ObjectPool
 â”œâ”€â”€ game: Game reference
 â””â”€â”€ emits: 'weapon:fired'

Enemy
 â”œâ”€â”€ config: EnemyConfig
 â”œâ”€â”€ type: string
 â””â”€â”€ spawns: ResourceOrb[]

UI
 â”œâ”€â”€ eventBus: EventBus
 â””â”€â”€ listens: 'ammo:*', 'resource:*'
```

---

## Key Principles

1. **Composition** - Mix behaviors, not inherit
2. **Events** - Decouple communication
3. **Data** - Config files, not hardcoded
4. **Pool** - Reuse, don't recreate
5. **Debug** - See it, don't guess it

---

## Benefits Visualization

### Before (Tight Coupling)
```
Player â”€â”€â”€â”€â”€â–º UI.updateAmmo()
   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â–º SoundManager.play()
```
**Problem:** Player needs to know about UI, Sound, etc.

### After (Event-Driven)
```
Player â”€â”€â”€â”€â–º EventBus.emit('ammo:changed')
                   â”‚
                   â”œâ”€â”€â–º UI listens
                   â”œâ”€â”€â–º Sound listens
                   â””â”€â”€â–º Any system can listen!
```
**Benefit:** Player doesn't know who's listening!

---

This architecture scales from indie to AAA! ğŸš€
